<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Survivor Bingo</title>
  <style>
    body {
      font-family: 'Trebuchet MS', sans-serif;
      background: url('https://images.pexels.com/photos/457882/pexels-photo-457882.jpeg') no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      padding: 2rem;
      color: #fff;
      text-align: center;
    }
    h1 {
      margin-bottom: 1rem;
      text-shadow: 2px 2px 4px #000;
    }
    #bingo {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 5px;
      max-width: 600px;
      margin: 0 auto;
    }
    .square {
      background-color: rgba(0, 0, 0, 0.7);
      border: 2px solid #fff;
      padding: 1rem;
      cursor: pointer;
      min-height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      transition: background-color 0.3s;
    }
    .square.marked {
      background-color: rgba(255, 215, 0, 0.8);
      color: #000;
      font-weight: bold;
    }
    #reset, #shareBtn, #savePdfBtn {
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      background-color: gold;
      border: none;
      cursor: pointer;
      border-radius: 8px;
      margin-right: 10px;
    }
    #bingo-message {
      margin-top: 1rem;
      font-size: 1.5rem;
      font-weight: bold;
      color: gold;
      text-shadow: 2px 2px 4px #000;
    }

    /* Print styling */
    @media print {
      body {
        background: none;
        color: #000;
      }
      #reset, #shareBtn, #savePdfBtn {
        display: none;
      }
      .square {
        border: 1px solid #000;
        background-color: #fff !important;
        color: #000 !important;
      }
      #bingo-message {
        color: black;
        text-shadow: none;
      }
    }
  </style>
</head>
<body>
  <h1>Survivor Bingo</h1>
  <div id="bingo"></div>
  <div id="bingo-message"></div>
  <button id="reset">New Board</button>
  <button id="shareBtn">Get Board Link</button>
  <button id="savePdfBtn">Print</button>

  <script>
    const phrases = [
      "Hidden Immunity Idol found",
      "Shot in the Dark used",
      "Someone cries during a confessional",
      "Jeff says 'Come on in!'",
      "Fire-making challenge",
      "Advantage gets nullified",
      "Someone says 'trust' 5 times",
      "Puzzle comeback win",
      "Sits out of a challenge",
      "Tribe Swap",
      "Winnerâ€™s edit moment",
      "Backstab by an ally",
      "Unanimous vote",
      "Fake idol is played",
      "Blindside at Tribal Council",
      "Split vote strategy",
      "Vote steal or extra vote used",
      "Someone falls in a challenge",
      "Final Four fire-making",
      "Family visit moment",
      "Someone pulls rocks",
      "Old school player references",
      "Someone tries to throw a challenge",
      "Players argue about rice",
      "Secret Advantage found",
      "Double Tribal Council night",
      "Someone wins immunity by seconds",
      "Someone sits out for food",
      "Someone finds advantage under the shelter",
      "Winner mentions family in speech",
      "Someone makes a final three deal too early",
      "Challenge involves balancing something",
      "Undercover alliance is revealed",
      "Fire Tokens are mentioned",
      "Someone gives up reward to someone else"
    ];

    const bingoBoard = document.getElementById("bingo");
    const resetBtn = document.getElementById("reset");
    const shareBtn = document.getElementById("shareBtn");
    const message = document.getElementById("bingo-message");

    let currentSeed = null;

    function shuffle(array) {
      let copy = [...array];
      for (let i = copy.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    }

    function checkBingo() {
      const squares = Array.from(document.querySelectorAll(".square"));
      const marked = squares.map(sq => sq.classList.contains("marked"));
      const lines = [
        [0,1,2,3,4], [5,6,7,8,9], [10,11,12,13,14], [15,16,17,18,19], [20,21,22,23,24],
        [0,5,10,15,20], [1,6,11,16,21], [2,7,12,17,22], [3,8,13,18,23], [4,9,14,19,24],
        [0,6,12,18,24], [4,8,12,16,20]
      ];
      for (const line of lines) {
        if (line.every(i => marked[i])) {
          message.textContent = "BINGO! You outwitted, outplayed, and outlasted!";
          return;
        }
      }
      message.textContent = "";
    }

    function generateBoard(seed) {
      bingoBoard.innerHTML = "";
      message.textContent = "";
      let shuffled;
      if (seed) {
        shuffled = shuffleWithSeed(phrases, seed);
      } else {
        shuffled = shuffle(phrases);
      }
      let tiles = shuffled.slice(0, 24);
      tiles.splice(12, 0, "FREE SPACE");
      tiles.forEach((text, index) => {
        const square = document.createElement("div");
        square.className = "square";
        square.textContent = text;
        if (text === "FREE SPACE") {
          square.classList.add("marked");
        }
        square.addEventListener("click", () => {
          square.classList.toggle("marked");
          checkBingo();
        });
        bingoBoard.appendChild(square);
      });
    }

    function shuffleWithSeed(array, seed) {
      let copy = [...array];
      let random = mulberry32(seed);
      for (let i = copy.length - 1; i > 0; i--) {
        const j = Math.floor(random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    }

    function mulberry32(a) {
      return function() {
        let t = a += 0x6D2B79F5;
        t = Math.imul(t ^ t >>> 15, t | 1);
        t ^= t + Math.imul(t ^ t >>> 7, t | 61);
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
      }
    }

    function getSeedFromURL() {
      const params = new URLSearchParams(window.location.search);
      return parseInt(params.get("seed"));
    }

    function createShareLink() {
      const seed = currentSeed; // Use the actual current seed value
      const url = new URL(window.location.href);
      url.searchParams.set("seed", seed);
      history.replaceState(null, null, url.toString());  // Update URL without resetting the board
      navigator.clipboard.writeText(url.toString())
        .then(() => {
          alert("Board link copied to clipboard! You can share it now.");
        });
    }

    function resetBoard() {
  currentSeed = Math.floor(Math.random() * 100000);
  generateBoard(currentSeed);
  const url = new URL(window.location.href);
  url.searchParams.set("seed", currentSeed);
  history.replaceState(null, null, url.toString()); // update URL immediately
}

    function printBoard() {
      window.print();
    }

    shareBtn.addEventListener("click", createShareLink);
    resetBtn.addEventListener("click", resetBoard);
    document.getElementById("savePdfBtn").addEventListener("click", printBoard);

    window.onload = () => {
      const seed = getSeedFromURL();
      currentSeed = seed || Math.floor(Math.random() * 100000); // Use seed from URL or random one
      generateBoard(currentSeed);
    };
  </script>
</body>
</html>
